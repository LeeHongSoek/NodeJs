<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title><%= table_info.tableNameKor %> 리스트</title>
    
    <style type="text/css">
        table.type02 {
            border-collapse: separate;
            border-spacing: 0;
            text-align: left;
            line-height: 1.5;
            border-top: 1px solid #ccc;
            border-left: 1px solid #ccc;
            margin : 10px 5px;
        }
        table.type02 caption {
            padding: 10px;
            font-size: 10;
            font-weight: bold;
            vertical-align: top;
            text-align: center;
            border-right: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            border-top: 1px solid #ccc;
            border-left: 1px solid #ccc;
            background: #ddd;
        }
        table.type02 th {
            padding: 10px;
            font-weight: bold;
            vertical-align: middle;
            text-align: center;
            border-right: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            border-top: 1px solid #fff;
            border-left: 1px solid #fff;
            background: #eee;
        }
        table.type02 td {
            padding: 10px;
            vertical-align: top;
            border-right: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
        }
        table.type02 td.center {
            text-align: center;   
        }
    </style>

    <script src="http://code.jquery.com/jquery-latest.min.js">/*jquery 최신버전 사용*/</script>

    <script>
        $(document).ready(function(){
            $('input#btnSearch').click(function(){
                $.ajax({ url        : '/json/customers', // 요청 할 주소 
                         async      : true, // false 일 경우 동기 요청으로 변경
                         type       : 'GET', // GET, PUT
                         data       : {   
                                        <% 
                                        var cnt = 0
                                        var keys = Object.keys(table_info.searchs) //키를 가져옵니다. 이때, keys 는 반복가능한 객체가 됩니다.
                                        for (var key in keys) {
                                            console.log("key : " + key + ", value : " + req.query[key])
                                            <% if(cnt>0) {%>,<%} %> <%=key%> : $('input[name=<%=key%>]').val()
                                        }
                                        %>
                                      }, // 전송할 데이터                
                         dataType   : 'json', // xml, json, script, html                
                         beforeSend : function(jqXHR) {}, // 서버 요청 전 호출 되는 함수 return false; 일 경우 요청 중단                
                         success    : function(jqXHR) { // 요청 완료 시        
                            if(jqXHR.result.length === 0)
                            {
                                $('tbody#tbodyNodata').show();
                                $('tbody#tbodyData').hide()
                            } 
                            else {
                                $('tbody#tbodyNodata').hide()
                                $('tbody#tbodyData').show();
                            }
                                
                            $("#resultTable").find('tbody#tbodyData').children().remove ();
                            $.each(jqXHR.result, function(idx, item){
                                
                                $("#resultTable").find('tbody#tbodyData').append("<tr>");
                                <% 
                                var keys = Object.keys(table_info.fields) //키를 가져옵니다. 이때, keys 는 반복가능한 객체가 됩니다.
                                for (var key in keys) {
                                    var val = table_info.fields[key]
                                    if (val.isListView) {
                                        %>
                                        $("#resultTable").find('tbody#tbodyData').append("<td maxlength='<%=val.maxlength%>'>"+item.<%=key%>+"&nbsp;</td>");
                                        <% 
                                    }
                                }
                                %>
                                $("#resultTable").find('tbody#tbodyData').append("</tr>");
                            });
                         }, 
                         error      : function(jqXHR) {}, // 요청 실패.                
                         complete   : function(jqXHR) {}  // 요청의 실패, 성공과 상관 없이 완료 될 경우 호출});
                       })
            })
        })
    </script>
</head>
<body>

    


    <h1>Welcome to my home page</h1>

    <table class="type02">
        <tr>
            <th><%=table_info.searchs.customerName.nameKor%></th>
            <td><input name="customerName" type="text" maxlength="<%=table_info.searchs.customerName.maxLength%>"></td>

            <th><%=table_info.searchs.contactLastName.nameKor%></th>
            <td><input name="contactLastName" type="text" maxlength="<%=table_info.searchs.contactLastName.maxLength%>"></td>

            <td><input id="btnSearch" type="button" value="검색" /></td>
        </tr>
    </table>

    <table id="resultTable" class="type02">
        <caption><%= table_info.tableNameKor %> 리스트</caption>
        <thead>
            <tr>
                <% 
                let colLength = 0

                var keys = Object.keys(table_info.fields)
                for(var key in keys) {
                    if(table_info.fields[key].isListView) {
                        %>
                        <th><%=table_info.fields[key].nameKor%></th>
                        <% 
                        colLength++
                    }
                }
                %>
            </tr>
        </thead>
        <tbody id="tbodyNodata">
            <tr>
                <td colspan="<%=colLength%>" class="center">자료없음</tㅇ>
            </tr>
        </tbody>
        <tbody id="tbodyData" style="display: none;">
        </tbody>
    </table>
</body>
</html>






